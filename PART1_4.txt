                                    <?php
                                    $selected_users = get_post_meta($message_id, 'selected_users', true);
                                    if(!empty($selected_users)) {
                                        $users_array = maybe_unserialize($selected_users);
                                        foreach($users_array as $user_id) {
                                            $user = get_userdata($user_id);
                                            if($user) {
                                                echo '<span class="badge bg-info me-1">' . esc_html($user->display_name) . '</span>';
                                            }
                                        }
                                    }
                                    ?>
                                </td>
                            <?php endif; ?>
                            <td>
                                <div class="message-actions">
                                    <button class="btn btn-sm btn-primary view-message" 
                                            data-bs-toggle="modal"
                                            data-bs-target="#messageModal"
                                            data-id="<?php echo $message_id; ?>"
                                            data-title="<?php echo esc_attr(get_the_title()); ?>"
                                            data-content="<?php echo esc_attr(get_the_content()); ?>"
                                            title="Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾ÛŒØ§Ù…">
                                        ğŸ‘ï¸
                                    </button>
                                    <button class="btn btn-sm btn-success reply-message"
                                            data-id="<?php echo $message_id; ?>"
                                            title="Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ù¾ÛŒØ§Ù…">
                                        â†©ï¸
                                    </button>
                                </div>
                            </td>
                            <td data-order="<?php echo $post_date; ?>">
                                <div class="message-date">
                                    <div class="date-ago"><?php echo $time_ago; ?></div>
                                    <div class="time"><?php echo get_post_time('H:i', false); ?></div>
                                </div>
                            </td>
                        </tr>
                    <?php endwhile; wp_reset_postdata(); ?>
                </tbody>
            </table>

            <!-- Ù…ÙˆØ¯Ø§Ù„ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… -->
            <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="messageModalLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body"></div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¨Ø³ØªÙ†</button>
                        </div>
                    </div>
                </div>
            </div>
        <?php endif; ?>
    </div>
    <?php
    return ob_get_clean();
}

// ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
function get_user_role_fa($user_id) {
    $user = get_userdata($user_id);
    if (!$user) return '';
    
    $roles = array_values($user->roles);
    if (empty($roles)) return '';
    
    $role_names = array(
        'administrator' => 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…',
        'editor' => 'ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø±',
        'author' => 'Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡',
        'contributor' => 'Ù…Ø´Ø§Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡',
        'subscriber' => 'Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ',
        'shop_manager' => 'Ù…Ø¯ÛŒØ± ÙØ±ÙˆØ´Ú¯Ø§Ù‡',
        'customer' => 'Ù…Ø´ØªØ±ÛŒ',
        'admin_group' => 'Ú¯Ø±ÙˆÙ‡ Ù…Ø¯ÛŒØ±ÛŒØª'
    );
    
    return isset($role_names[$roles[0]]) ? $role_names[$roles[0]] : 'Ú©Ø§Ø±Ø¨Ø±';
}
// PART 2: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ
add_action('wp_head', 'inbox_messages_styles');

function inbox_messages_styles() {
    ?>
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒ Ùˆ wrapper */
        .inbox-messages-wrapper {
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px auto;
            direction: rtl;
        }

        .inbox-messages-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .inbox-messages-header h2 {
            color: #0F2E6B;
            margin: 0;
            font-size: 24px;
            font-weight: bold;
        }

        .messages-stats {
            display: flex;
            gap: 20px;
        }

        .messages-stats span {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 14px;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø´Ù†Ø§Ø³Ù‡ Ù¾ÛŒØ§Ù… */
        .message-id {
            font-family: monospace;
            font-size: 14px;
            color: #0F2E6B;
            font-weight: bold;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÙˆÙ„ Ø§ØµÙ„ÛŒ */
        #inbox-messages-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: #fff;
            margin-bottom: 20px;
        }

        #inbox-messages-table thead th {
            background: #0F2E6B;
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: right;
        }

        #inbox-messages-table tbody td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¹Ù†ÙˆØ§Ù† Ùˆ Ù…Ø­ØªÙˆØ§ÛŒ Ù¾ÛŒØ§Ù… */
        .message-title {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .message-title strong {
            color: #0F2E6B;
            font-size: 16px;
        }

        .message-preview {
            color: #666;
            font-size: 13px;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±Ø³ØªÙ†Ø¯Ù‡ */
        .sender-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .sender-name {
            color: #0F2E6B;
            font-size: 14px;
            font-weight: bold;
        }

        .sender-role {
            background: #f0f0f0;
            color: #666;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† */
        .message-date {
            display: flex;
            flex-direction: column;
            gap: 5px;
            align-items: center;
        }

        .date-ago {
            color: #666;
            font-size: 13px;
        }

        .time {
            color: #0F2E6B;
            font-size: 14px;
            font-weight: bold;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ§Ù… */
        .message-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .status-read {
            background: #e3f9e5;
            color: #1b874b;
        }

        .status-unread {
            background: #fff4de;
            color: #c76615;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù¾ÛŒÙˆØ³Øªâ€ŒÙ‡Ø§ */
        .attachments-preview {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .attachment-count {
            font-size: 13px;
            color: #666;
        }

        .attachment-list {
            display: flex;
            gap: 5px;
        }

        .attachment-link {
            text-decoration: none;
            font-size: 20px;
            color: #0F2E6B;
            transition: transform 0.2s ease;
        }

        .attachment-link:hover {
            transform: scale(1.2);
        }

        .no-attachment {
            color: #999;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª */
        .message-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-start;
        }

        .message-actions button {
            border: none;
            background: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .message-actions button:hover {
            transform: scale(1.2);
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø­Ø§Ù„Øª Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ§Ù… */
        .no-messages {
            text-align: center;
            padding: 50px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 20px 0;
        }

        .no-messages-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .no-messages h3 {
            color: #0F2E6B;
            margin-bottom: 10px;
        }

        .no-messages p {
            color: #666;
            margin-bottom: 20px;
        }

        .new-message-btn {
            display: inline-block;
            padding: 10px 25px;
            background: #0F2E6B;
            color: white !important;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .new-message-btn:hover {
            background: #0a1f4d;
            transform: translateY(-2px);
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…ÙˆØ¯Ø§Ù„ Ø¨ÙˆØªâ€ŒØ§Ø³ØªØ±Ù¾ */
        .modal-content {
            direction: rtl;
        }

        .modal-header {
            background: #0F2E6B;
            color: white;
            border-radius: 8px 8px 0 0;
            padding: 15px 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            color: white;
        }

        .modal-body {
            padding: 20px;
            line-height: 1.8;
            font-size: 15px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            border-top: 1px solid #eee;
            padding: 15px;
        }

        /* Ø¨Ù‡Ø¨ÙˆØ¯ Ø§Ø³ØªØ§ÛŒÙ„ DataTables */
        .dataTables_wrapper {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
        }

        .dataTables_filter {
            margin-bottom: 20px;
        }

        .dataTables_filter label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #666;
        }

        .dataTables_filter input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            width: 300px;
            font-size: 14px;
            transition: all 0.3s ease;
            direction: rtl;
        }

        .dataTables_filter input:focus {
            border-color: #0F2E6B;
            outline: none;
            box-shadow: 0 0 0 3px rgba(15, 46, 107, 0.1);
        }

        .dataTables_filter input::placeholder {
            color: #999;
        }

        .dataTables_wrapper .dataTables_length select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 8px 12px;
            margin: 0 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: #0F2E6B;
            color: white !important;
            border-color: #0F2E6B;
        }

        .dataTables_wrapper .dataTables_info {
            padding: 10px 0;
            color: #666;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            z-index: 1000;
            display: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        /* ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§ÛŒÛŒ */
        @media screen and (max-width: 768px) {
            .inbox-messages-wrapper {
                width: 95% !important;
                padding: 10px;
            }

            .inbox-messages-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .message-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .modal-content {
                width: 95%;
                margin: 20px auto;
            }

            #inbox-messages-table {
                font-size: 14px;
            }

            .message-title strong {
                font-size: 14px;
            }

            .message-preview {
                font-size: 12px;
            }

            .message-date {
                font-size: 12px;
            }

            .dataTables_filter input {
                width: 100%;
            }
        }
    </style>
    <?php
}
// PART 3: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ Ùˆ AJAX handler
add_action('wp_footer', 'inbox_messages_scripts');
add_action('wp_ajax_mark_message_as_read', 'mark_message_as_read_handler');

// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª AJAX
function mark_message_as_read_handler() {
    // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ
    if (!isset($_POST['nonce']) || !wp_verify_nonce($_POST['nonce'], 'read_message_nonce')) {
        wp_send_json_error('Ø®Ø·Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ');
    }
    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø´Ù†Ø§Ø³Ù‡ Ù¾ÛŒØ§Ù…
    if (!isset($_POST['message_id'])) {
        wp_send_json_error('Ø´Ù†Ø§Ø³Ù‡ Ù¾ÛŒØ§Ù… Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
    }
    $message_id = intval($_POST['message_id']);
    $current_user_id = get_current_user_id();
    // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ù¾ÛŒØ§Ù…
    $selected_users = get_post_meta($message_id, 'selected_users', true);
    $users_array = maybe_unserialize($selected_users);
    if (!current_user_can('administrator') && (!is_array($users_array) || !in_array($current_user_id, $users_array))) {
        wp_send_json_error('Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯');
    }
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù† Ù¾ÛŒØ§Ù…
    $result = update_post_meta($message_id, 'viewed_by_' . $current_user_id, true);
    if ($result) {
        wp_send_json_success(array(
            'message' => 'Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯',
            'message_id' => $message_id
        ));
    } else {
        wp_send_json_error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ§Ù…');
    }
}
function inbox_messages_scripts() {
    ?>
    <script>
        jQuery(document).ready(function($) {
            // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø²Ù…Ø§Ù† Ùˆ Ú©Ø§Ø±Ø¨Ø±
            var currentUser = '<?php echo esc_js(wp_get_current_user()->user_login); ?>'; // RoOtIt-wordpress
            var currentTime = '<?php echo esc_js(current_time('mysql')); ?>'; // 2025-02-23 16:55:58

            // ØªÙ†Ø¸ÛŒÙ…Ø§Øª DataTables
            if (!$.fn.DataTable.isDataTable('#inbox-messages-table')) {
                var messagesTable = $('#inbox-messages-table').DataTable({
                    responsive: true,
                    pageLength: 25,
                    lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "Ù‡Ù…Ù‡"]],
                    order: [[0, 'desc']], // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ù†Ø§Ø³Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª Ù†Ø²ÙˆÙ„ÛŒ
                    language: {
                        "sEmptyTable":     "Ù¾ÛŒØ§Ù…ÛŒ Ø¯Ø± ØµÙ†Ø¯ÙˆÙ‚ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª",
                        "sInfo":           "Ù†Ù…Ø§ÛŒØ´ _START_ ØªØ§ _END_ Ø§Ø² _TOTAL_ Ù¾ÛŒØ§Ù…",
                        "sInfoEmpty":      "Ù†Ù…Ø§ÛŒØ´ 0 ØªØ§ 0 Ø§Ø² 0 Ù¾ÛŒØ§Ù…",
                        "sInfoFiltered":   "(ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡ Ø§Ø² _MAX_ Ù¾ÛŒØ§Ù…)",
                        "sInfoPostFix":    "",
                        "sInfoThousands":  ",",
                        "sLengthMenu":     "_MENU_",
                        "sLoadingRecords": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...",
                        "sProcessing":     "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...",
                        "sSearch":         "Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ:",
                        "sZeroRecords":    "Ù¾ÛŒØ§Ù…ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯",
                        "oPaginate": {
                            "sFirst":    "Ø§ÙˆÙ„ÛŒÙ†",
                            "sLast":     "Ø¢Ø®Ø±ÛŒÙ†",
                            "sNext":     "Ø¨Ø¹Ø¯ÛŒ",
                            "sPrevious": "Ù‚Ø¨Ù„ÛŒ"
                        },
                        "oAria": {
                            "sSortAscending":  ": ÙØ¹Ø§Ù„ Ø³Ø§Ø²ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ ØµÙˆØ±Øª ØµØ¹ÙˆØ¯ÛŒ",
                            "sSortDescending": ": ÙØ¹Ø§Ù„ Ø³Ø§Ø²ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ ØµÙˆØ±Øª Ù†Ø²ÙˆÙ„ÛŒ"
                        }
                    },
                    columnDefs: [
                        {
                            targets: [3, 5], // Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÙˆØ³Øª Ùˆ Ø¹Ù…Ù„ÛŒØ§Øª
                            orderable: false
                        }
                    ],
                    initComplete: function() {
                        $('.dataTables_filter input')
                            .attr('placeholder', 'Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø¹Ù†ÙˆØ§Ù†ØŒ Ù…ØªÙ† ÛŒØ§ Ù†Ø§Ù… ÙØ±Ø³ØªÙ†Ø¯Ù‡...')
                            .css('direction', 'rtl');
                    }
                });

                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬Ø¯ÙˆÙ„ Ø¯Ø± ØªØºÛŒÛŒØ± Ø³Ø§ÛŒØ² ØµÙØ­Ù‡
                $(window).resize(function() {
                    messagesTable.columns.adjust().responsive.recalc();
                });
            }

            // Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾ÛŒØ§Ù…
            $(document).on('click', '.view-message', function() {
                var button = $(this);
                var messageId = button.data('id');
                var title = button.data('title');
                var content = button.data('content');
                var row = button.closest('tr');

                // ØªÙ†Ø¸ÛŒÙ… Ù…Ø­ØªÙˆØ§ÛŒ Ù…ÙˆØ¯Ø§Ù„
                $('#messageModalLabel').text(title);
                $('.modal-body').html(content.replace(/\n/g, '<br>'));

                // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡
                if (!row.hasClass('read-row')) {
                    $.ajax({
                        url: ajaxurl,
                        type: 'POST',
                        data: {
                            action: 'mark_message_as_read',
                            message_id: messageId,
                            nonce: '<?php echo wp_create_nonce("read_message_nonce"); ?>'
                        },
                        success: function(response) {
                            if (response.success) {
                                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¸Ø§Ù‡Ø± Ø±Ø¯ÛŒÙ
                                row.removeClass('unread-row').addClass('read-row');
                                row.find('.message-status')
                                   .removeClass('status-unread')
                                   .addClass('status-read')
                                   .text('Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡');

                                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù†Ø´Ø¯Ù‡
                                updateUnreadCount();

                                // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ù…ÙˆÙÙ‚ÛŒØª
                                showNotification('Ù¾ÛŒØ§Ù… Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯', 'success');
                            } else {
                                showNotification(response.data || 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ§Ù…', 'error');
                            }
                        },
                        error: function() {
                            showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                        }
                    });
                }
            });

            // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
            function showNotification(message, type) {
                // Ø­Ø°Ù Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
                $('.notification').remove();

                // Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¬Ø¯ÛŒØ¯
                var notification = $('<div>')
                    .addClass('notification ' + type)
                    .text(message)
                    .appendTo('body')
                    .fadeIn();

                // Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ø² 3 Ø«Ø§Ù†ÛŒÙ‡
                setTimeout(function() {
                    notification.fadeOut(function() {
                        $(this).remove();
                    });
                }, 3000);
            }

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù†Ø´Ø¯Ù‡
            function updateUnreadCount() {
                var unreadCount = $('.unread-row').length;
                $('.unread-messages').html(
                    '<i class="fas fa-envelope"></i> Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù†Ø´Ø¯Ù‡: ' + unreadCount + ' Ù¾ÛŒØ§Ù…'
                );
            }

            // Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù†Ø´Ø¯Ù‡
            updateUnreadCount();
        });
    </script>
    <?php
}